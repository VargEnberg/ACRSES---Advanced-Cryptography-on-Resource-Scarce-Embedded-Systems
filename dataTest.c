#include "aes.h"
#include "func.h"
#include "pico/stdlib.h"
#include <time.h>
#include <stdio.h>
#include <stdlib.h>
#define BLOCKS 1
#define bigArraySize 1000
#define CYCLES 1
#define AES_ITERATIONS 1
#define irq1Pin 2
#define irq2Pin 3
#define irq3Pin 4
#define irq4Pin 5
//#define debug 1 // enables debug mode
//#define CMAC 1 // enables CMAC in the floating point operations
#define MAXTESTS 1
#define ALARM_NUM 0
#define ALARM_IRQ TIMER_IRQ_0
#define TIMER 200
#define INTERRUPTITERATIONS 15
//#define LONGTEST 1 // enables testing of 4096 byte.

/* floating point division. returns a double. 
Parameters: double d: Randomiser   
            int cycles: Does 4*cycles floating point divisions. */
double floating(double d, int cycles); 

/* Claims a chunk of memory. Amount claimed is based on int size.
returns a pointer to the adress of the first position of the array.
Parameters: int size - how big the array that is created will be 
  */
int * memoryClaim(int size);

void gpioSetup();

void encryptionTest(int iterations, const struct AES_ctx* ctx, u_int8_t* text);

void decryptionTest(int iterations, const struct AES_ctx* ctx, u_int8_t* text);

void irq_handler();

static void timer_irq();

static void timer_in_us(uint32_t delay_us);

double globalReturnExec;
double timerTime;

int cyclesRun = 0;
int encryption = 0;
int decryption = 0;
int floatOp = 0;

//for AES128
uint8_t key[BLOCK_SIZE] = {     (uint8_t) 0x2a, (uint8_t) 0x99, (uint8_t) 0x79, (uint8_t) 0x1b,
                                (uint8_t) 0xca, (uint8_t) 0xac, (uint8_t) 0xdc, (uint8_t) 0x3d,
                                (uint8_t) 0x12, (uint8_t) 0x43, (uint8_t) 0x83, (uint8_t) 0x29, 
                                (uint8_t) 0xb5, (uint8_t) 0x7f, (uint8_t) 0xb1, (uint8_t) 0xb2 };
//For AES256
/*uint8_t key[BLOCK_SIZE*2] = {   (uint8_t) 0x2a, (uint8_t) 0x99, (uint8_t) 0x79, (uint8_t) 0x1b,
                                (uint8_t) 0xca, (uint8_t) 0xac, (uint8_t) 0xdc, (uint8_t) 0x3d,
                                (uint8_t) 0x12, (uint8_t) 0x43, (uint8_t) 0x83, (uint8_t) 0x29, 
                                (uint8_t) 0xb5, (uint8_t) 0x7f, (uint8_t) 0xb1, (uint8_t) 0xb2,
                                (uint8_t) 0x2a, (uint8_t) 0x99, (uint8_t) 0x79, (uint8_t) 0x1b,
                                (uint8_t) 0xca, (uint8_t) 0xac, (uint8_t) 0xdc, (uint8_t) 0x3d,
                                (uint8_t) 0x12, (uint8_t) 0x43, (uint8_t) 0x83, (uint8_t) 0x29, 
                                (uint8_t) 0xb5, (uint8_t) 0x7f, (uint8_t) 0xb1, (uint8_t) 0xb2  };*/

uint8_t longText[4096] = {0x57,0x65,0x6c,0x6c,0x2c,0x20,0x74,0x6f,0x20,0x62,0x65,0x20,0x74,0x72,0x75,0x74,0x68,0x66,0x75,0x6c,0x20,0x74,
0x68,0x65,0x20,0x62,0x6c,0x75,0x65,0x70,0x72,0x69,0x6e,0x74,0x27,0x73,0x20,0x53,0x69,0x6d,0x70,0x6c,0x79,0x20,0x72,0x61,0x67,0x65,0x20,
0x61,0x6e,0x64,0x20,0x79,0x6f,0x75,0x74,0x68,0x66,0x75,0x6c,0x20,0x65,0x78,0x75,0x62,0x65,0x72,0x61,0x6e,0x63,0x65,0x20,0x45,0x76,0x65,
0x72,0x79,0x62,0x6f,0x64,0x79,0x20,0x6c,0x6f,0x76,0x65,0x73,0x20,0x74,0x6f,0x20,0x72,0x6f,0x6f,0x74,0x20,0x66,0x6f,0x72,0x20,0x61,0x20,
0x6e,0x75,0x69,0x73,0x61,0x6e,0x63,0x65,0x20,0x48,0x69,0x74,0x20,0x74,0x68,0x65,0x20,0x45,0x61,0x72,0x74,0x68,0x20,0x6c,0x69,0x6b,0x65,
0x20,0x61,0x6e,0x20,0x61,0x73,0x74,0x65,0x72,0x6f,0x69,0x64,0x20,0x44,0x69,0x64,0x20,0x6e,0x6f,0x74,0x68,0x69,0x6e,0x67,0x20,0x62,0x75,
0x74,0x20,0x73,0x68,0x6f,0x6f,0x74,0x20,0x66,0x6f,0x72,0x20,0x74,0x68,0x65,0x20,0x4d,0x6f,0x6f,0x6e,0x20,0x73,0x69,0x6e,0x63,0x65,0x20,
0x28,0x50,0x65,0x77,0x21,0x29,0x20,0x4d,0x43,0x73,0x20,0x67,0x65,0x74,0x20,0x74,0x61,0x6b,0x65,0x6e,0x20,0x74,0x6f,0x20,0x73,0x63,0x68,
0x6f,0x6f,0x6c,0x20,0x77,0x69,0x74,0x68,0x20,0x74,0x68,0x69,0x73,0x20,0x6d,0x75,0x73,0x69,0x63,0x20,0x27,0x43,0x61,0x75,0x73,0x65,0x20,
0x49,0x20,0x75,0x73,0x65,0x20,0x69,0x74,0x20,0x61,0x73,0x20,0x61,0x20,0x76,0x65,0x68,0x69,0x63,0x6c,0x65,0x20,0x74,0x6f,0x20,0x22,0x62,
0x75,0x73,0x20,0x74,0x68,0x65,0x20,0x72,0x68,0x79,0x6d,0x65,0x22,0x20,0x4e,0x6f,0x77,0x20,0x49,0x20,0x6c,0x65,0x61,0x64,0x20,0x61,0x20,
0x6e,0x65,0x77,0x20,0x73,0x63,0x68,0x6f,0x6f,0x6c,0x20,0x66,0x75,0x6c,0x6c,0x20,0x6f,0x66,0x20,0x73,0x74,0x75,0x64,0x65,0x6e,0x74,0x73,
0x20,0x4d,0x65,0x3f,0x20,0x49,0x27,0x6d,0x20,0x61,0x20,0x70,0x72,0x6f,0x64,0x75,0x63,0x74,0x20,0x6f,0x66,0x20,0x52,0x61,0x6b,0x69,0x6d,
0x20,0x4c,0x61,0x6b,0x69,0x6d,0x20,0x53,0x68,0x61,0x62,0x61,0x7a,0x7a,0x2c,0x20,0x32,0x50,0x61,0x63,0x2c,0x20,0x4e,0x2e,0x57,0x2e,0x41,
0x2c,0x20,0x43,0x75,0x62,0x65,0x2c,0x20,0x68,0x65,0x79,0x20,0x44,0x6f,0x63,0x2c,0x20,0x52,0x65,0x6e,0x20,0x59,0x65,0x6c,0x6c,0x61,0x2c,
0x20,0x45,0x61,0x7a,0x79,0x2c,0x20,0x74,0x68,0x61,0x6e,0x6b,0x20,0x79,0x6f,0x75,0x2c,0x20,0x74,0x68,0x65,0x79,0x20,0x67,0x6f,0x74,0x20,
0x53,0x6c,0x69,0x6d,0x20,0x49,0x6e,0x73,0x70,0x69,0x72,0x65,0x64,0x20,0x65,0x6e,0x6f,0x75,0x67,0x68,0x20,0x74,0x6f,0x20,0x6f,0x6e,0x65,
0x20,0x64,0x61,0x79,0x20,0x67,0x72,0x6f,0x77,0x20,0x75,0x70,0x2c,0x20,0x62,0x6c,0x6f,0x77,0x20,0x75,0x70,0x20,0x61,0x6e,0x64,0x20,0x62,
0x65,0x20,0x69,0x6e,0x20,0x61,0x20,0x70,0x6f,0x73,0x69,0x74,0x69,0x6f,0x6e,0x20,0x54,0x6f,0x20,0x6d,0x65,0x65,0x74,0x20,0x52,0x75,0x6e,
0xe2,0x80,0x93,0x44,0x2e,0x4d,0x2e,0x43,0x2e,0x2c,0x20,0x61,0x6e,0x64,0x20,0x69,0x6e,0x64,0x75,0x63,0x74,0x20,0x74,0x68,0x65,0x6d,0x20,
0x49,0x6e,0x74,0x6f,0x20,0x74,0x68,0x65,0x20,0x6d,0x6f,0x74,0x68,0x65,0x72,0x66,0x75,0x63,0x6b,0x69,0x6e,0x27,0x20,0x52,0x6f,0x63,0x6b,
0x20,0x61,0x6e,0x64,0x20,0x52,0x6f,0x6c,0x6c,0x20,0x48,0x61,0x6c,0x6c,0x20,0x6f,0x66,0x20,0x46,0x61,0x6d,0x65,0x20,0x45,0x76,0x65,0x6e,
0x20,0x74,0x68,0x6f,0x75,0x67,0x68,0x20,0x49,0x27,0x6c,0x6c,0x20,0x77,0x61,0x6c,0x6b,0x20,0x69,0x6e,0x20,0x74,0x68,0x65,0x20,0x63,0x68,
0x75,0x72,0x63,0x68,0x20,0x61,0x6e,0x64,0x20,0x62,0x75,0x72,0x73,0x74,0x20,0x69,0x6e,0x20,0x61,0x20,0x62,0x61,0x6c,0x6c,0x20,0x6f,0x66,
0x20,0x66,0x6c,0x61,0x6d,0x65,0x73,0x20,0x4f,0x6e,0x6c,0x79,0x20,0x48,0x61,0x6c,0x6c,0x20,0x6f,0x66,0x20,0x46,0x61,0x6d,0x65,0x20,0x49,
0x27,0x6c,0x6c,0x20,0x62,0x65,0x20,0x69,0x6e,0x64,0x75,0x63,0x74,0x65,0x64,0x20,0x69,0x6e,0x20,0x69,0x73,0x20,0x74,0x68,0x65,0x20,0x61,
0x6c,0x63,0x6f,0x68,0x6f,0x6c,0x20,0x6f,0x66,0x20,0x66,0x61,0x6d,0x65,0x20,0x4f,0x6e,0x20,0x74,0x68,0x65,0x20,0x77,0x61,0x6c,0x6c,0x20,
0x6f,0x66,0x20,0x73,0x68,0x61,0x6d,0x65,0x20,0x59,0x6f,0x75,0x20,0x66,0x61,0x67,0x73,0x20,0x74,0x68,0x69,0x6e,0x6b,0x20,0x69,0x74,0x27,
0x73,0x20,0x61,0x6c,0x6c,0x20,0x61,0x20,0x67,0x61,0x6d,0x65,0x2c,0x20,0x27,0x74,0x69,0x6c,0x20,0x49,0x20,0x77,0x61,0x6c,0x6b,0x20,0x61,
0x20,0x66,0x6c,0x6f,0x63,0x6b,0x20,0x6f,0x66,0x20,0x66,0x6c,0x61,0x6d,0x65,0x73,0x20,0x4f,0x66,0x66,0x20,0x61,0x20,0x70,0x6c,0x61,0x6e,
0x6b,0x20,0x61,0x6e,0x64,0x2c,0x20,0x74,0x65,0x6c,0x6c,0x20,0x6d,0x65,0x20,0x77,0x68,0x61,0x74,0x20,0x69,0x6e,0x20,0x74,0x68,0x65,0x20,
0x66,0x75,0x63,0x6b,0x20,0x61,0x72,0x65,0x20,0x79,0x6f,0x75,0x20,0x74,0x68,0x69,0x6e,0x6b,0x69,0x6e,0x27,0x3f,0x20,0x4c,0x69,0x74,0x74,
0x6c,0x65,0x20,0x67,0x61,0x79,0x2d,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,0x20,0x62,0x6f,0x79,0x20,0x53,0x6f,0x20,0x67,0x61,0x79,0x20,0x49,
0x20,0x63,0x61,0x6e,0x20,0x62,0x61,0x72,0x65,0x6c,0x79,0x20,0x73,0x61,0x79,0x20,0x69,0x74,0x20,0x77,0x69,0x74,0x68,0x20,0x61,0x20,0x73,
0x74,0x72,0x61,0x69,0x67,0x68,0x74,0x20,0x66,0x61,0x63,0x65,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,0x20,0x62,0x6f,0x79,0x20,0x28,
0x48,0x61,0x2d,0x68,0x61,0x21,0x29,0x20,0x59,0x6f,0x75,0x27,0x72,0x65,0x20,0x77,0x69,0x74,0x6e,0x65,0x73,0x73,0x69,0x6e,0x27,0x20,0x61,
0x20,0x6d,0x61,0x73,0x73,0x2d,0x6f,0x63,0x63,0x75,0x72,0x20,0x4c,0x69,0x6b,0x65,0x20,0x79,0x6f,0x75,0x27,0x72,0x65,0x20,0x77,0x61,0x74,
0x63,0x68,0x69,0x6e,0x67,0x20,0x61,0x20,0x63,0x68,0x75,0x72,0x63,0x68,0x20,0x67,0x61,0x74,0x68,0x65,0x72,0x69,0x6e,0x67,0x20,0x74,0x61,
0x6b,0x65,0x20,0x70,0x6c,0x61,0x63,0x65,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,0x20,0x62,0x6f,0x79,0x20,0x22,0x4f,0x79,0x20,0x76,
0x65,0x79,0x2c,0x20,0x74,0x68,0x61,0x74,0x20,0x62,0x6f,0x79,0x27,0x73,0x20,0x67,0x61,0x79,0x21,0x22,0xe2,0x80,0x94,0x74,0x68,0x61,0x74,
0x27,0x73,0x20,0x61,0x6c,0x6c,0x20,0x74,0x68,0x65,0x79,0x20,0x73,0x61,0x79,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,0x20,0x62,0x6f,
0x79,0x20,0x59,0x6f,0x75,0x20,0x67,0x65,0x74,0x20,0x61,0x20,0x74,0x68,0x75,0x6d,0x62,0x73,0x20,0x75,0x70,0x2c,0x20,0x70,0x61,0x74,0x20,
0x6f,0x6e,0x20,0x74,0x68,0x65,0x20,0x62,0x61,0x63,0x6b,0x20,0x41,0x6e,0x64,0x20,0x61,0x20,0x22,0x77,0x61,0x79,0x20,0x74,0x6f,0x20,0x67,
0x6f,0x22,0x20,0x66,0x72,0x6f,0x6d,0x20,0x79,0x6f,0x75,0x72,0x20,0x6c,0x61,0x62,0x65,0x6c,0x20,0x65,0x76,0x65,0x72,0x79,0x20,0x64,0x61,
0x79,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,0x20,0x62,0x6f,0x79,0x20,0x48,0x65,0x79,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,
0x20,0x62,0x6f,0x79,0x21,0x20,0x57,0x68,0x61,0x74,0x20,0x79,0x6f,0x75,0x20,0x73,0x61,0x79,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,
0x20,0x62,0x6f,0x79,0x3f,0x20,0x49,0x20,0x67,0x65,0x74,0x20,0x61,0x20,0x22,0x68,0x65,0x6c,0x6c,0x20,0x79,0x65,0x61,0x68,0x22,0x20,0x66,
0x72,0x6f,0x6d,0x20,0x44,0x72,0x65,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,0x20,0x62,0x6f,0x79,0x20,0x49,0x27,0x6d,0x61,0x20,0x77,
0x6f,0x72,0x6b,0x20,0x66,0x6f,0x72,0x20,0x65,0x76,0x65,0x72,0x79,0x74,0x68,0x69,0x6e,0x67,0x20,0x49,0x20,0x68,0x61,0x76,0x65,0x2c,0x20,
0x6e,0x65,0x76,0x65,0x72,0x20,0x61,0x73,0x6b,0x65,0x64,0x20,0x6e,0x6f,0x62,0x6f,0x64,0x79,0x20,0x66,0x6f,0x72,0x20,0x73,0x68,0x69,0x74,
0x20,0x47,0x65,0x74,0x20,0x6f,0x75,0x74,0x74,0x61,0x20,0x6d,0x79,0x20,0x66,0x61,0x63,0x65,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,
0x20,0x62,0x6f,0x79,0x21,0x20,0x42,0x61,0x73,0x69,0x63,0x61,0x6c,0x6c,0x79,0x2c,0x20,0x62,0x6f,0x79,0x2c,0x20,0x79,0x6f,0x75,0x27,0x72,
0x65,0x20,0x6e,0x65,0x76,0x65,0x72,0x20,0x67,0x6f,0x6e,0x6e,0x61,0x20,0x62,0x65,0x20,0x63,0x61,0x70,0x61,0x62,0x6c,0x65,0x20,0x4f,0x66,
0x20,0x6b,0x65,0x65,0x70,0x69,0x6e,0x27,0x20,0x75,0x70,0x20,0x77,0x69,0x74,0x68,0x20,0x74,0x68,0x65,0x20,0x73,0x61,0x6d,0x65,0x20,0x70,
0x61,0x63,0x65,0x2c,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,0x20,0x62,0x6f,0x79,0x2c,0x20,0x27,0x63,0x61,0x75,0x73,0x65,0xe2,0x80,0x94,
0x20,0x53,0x6f,0x20,0x79,0x6f,0x75,0x27,0x6c,0x6c,0x20,0x62,0x65,0x20,0x54,0x68,0x6f,0x72,0x20,0x61,0x6e,0x64,0x20,0x49,0x27,0x6c,0x6c,
0x20,0x62,0x65,0x20,0x4f,0x64,0x69,0x6e,0x20,0x59,0x6f,0x75,0x20,0x72,0x6f,0x64,0x65,0x6e,0x74,0x2c,0x20,0x49,0x27,0x6d,0x20,0x6f,0x6d,
0x6e,0x69,0x70,0x6f,0x74,0x65,0x6e,0x74,0x20,0x4c,0x65,0x74,0x20,0x6f,0x66,0x66,0x2c,0x20,0x74,0x68,0x65,0x6e,0x20,0x49,0x27,0x6d,0x20,
0x72,0x65,0x6c,0x6f,0x61,0x64,0x69,0x6e,0x27,0x20,0x49,0x6d,0x6d,0x65,0x64,0x69,0x61,0x74,0x65,0x6c,0x79,0x20,0x77,0x69,0x74,0x68,0x20,
0x74,0x68,0x65,0x73,0x65,0x20,0x62,0x6f,0x6d,0x62,0x73,0x20,0x49,0x27,0x6d,0x20,0x74,0x6f,0x74,0x69,0x6e,0x27,0x20,0x41,0x6e,0x64,0x20,
0x49,0x20,0x73,0x68,0x6f,0x75,0x6c,0x64,0x20,0x6e,0x6f,0x74,0x20,0x62,0x65,0x20,0x77,0x6f,0x6b,0x65,0x6e,0x20,0x49,0x27,0x6d,0x20,0x74,
0x68,0x65,0x20,0x77,0x61,0x6c,0x6b,0x69,0x6e,0x27,0x20,0x64,0x65,0x61,0x64,0x2c,0x20,0x62,0x75,0x74,0x20,0x49,0x27,0x6d,0x20,0x6a,0x75,
0x73,0x74,0x20,0x61,0x20,0x74,0x61,0x6c,0x6b,0x69,0x6e,0x27,0x20,0x68,0x65,0x61,0x64,0x2c,0x20,0x61,0x20,0x7a,0x6f,0x6d,0x62,0x69,0x65,
0x20,0x66,0x6c,0x6f,0x61,0x74,0x69,0x6e,0x27,0x20,0x42,0x75,0x74,0x20,0x49,0x20,0x67,0x6f,0x74,0x20,0x79,0x6f,0x75,0x72,0x20,0x6d,0x6f,
0x6d,0x20,0x64,0x65,0x65,0x70,0x2d,0x74,0x68,0x72,0x6f,0x61,0x74,0x69,0x6e,0x27,0x20,0x49,0x27,0x6d,0x20,0x6f,0x75,0x74,0x20,0x6d,0x79,
0x20,0x52,0x61,0x6d,0x65,0x6e,0x20,0x4e,0x6f,0x6f,0x64,0x6c,0x65,0x20,0x57,0x65,0x20,0x68,0x61,0x76,0x65,0x20,0x6e,0x6f,0x74,0x68,0x69,
0x6e,0x27,0x20,0x69,0x6e,0x20,0x63,0x6f,0x6d,0x6d,0x6f,0x6e,0x2c,0x20,0x70,0x6f,0x6f,0x64,0x6c,0x65,0x20,0x49,0x27,0x6d,0x20,0x61,0x20,
0x44,0x6f,0x62,0x65,0x72,0x6d,0x61,0x6e,0x2c,0x20,0x70,0x69,0x6e,0x63,0x68,0x20,0x79,0x6f,0x75,0x72,0x73,0x65,0x6c,0x66,0x20,0x69,0x6e,
0x20,0x74,0x68,0x65,0x20,0x61,0x72,0x6d,0x20,0x61,0x6e,0x64,0x20,0x70,0x61,0x79,0x20,0x68,0x6f,0x6d,0x61,0x67,0x65,0x2c,0x20,0x70,0x75,
0x70,0x69,0x6c,0x20,0x49,0x74,0x27,0x73,0x20,0x6d,0x65,0x2c,0x20,0x6d,0x79,0x20,0x68,0x6f,0x6e,0x65,0x73,0x74,0x79,0x27,0x73,0x20,0x62,
0x72,0x75,0x74,0x61,0x6c,0x20,0x42,0x75,0x74,0x20,0x49,0x20,0x64,0x6f,0x6e,0x27,0x74,0x20,0x75,0x74,0x69,0x6c,0x69,0x7a,0x65,0x20,0x77,
0x68,0x61,0x74,0x20,0x49,0x20,0x64,0x6f,0x20,0x74,0x68,0x6f,0x75,0x67,0x68,0x20,0x46,0x6f,0x72,0x20,0x67,0x6f,0x6f,0x64,0x20,0x61,0x74,
0x20,0x6c,0x65,0x61,0x73,0x74,0x20,0x6f,0x6e,0x63,0x65,0x20,0x69,0x6e,0x20,0x61,0x20,0x77,0x68,0x69,0x6c,0x65,0x20,0x53,0x6f,0x20,0x49,
0x20,0x77,0x61,0x6e,0x6e,0x61,0x20,0x6d,0x61,0x6b,0x65,0x20,0x73,0x75,0x72,0x65,0x20,0x73,0x6f,0x6d,0x65,0x77,0x68,0x65,0x72,0x65,0x20,
0x69,0x6e,0x20,0x74,0x68,0x69,0x73,0x20,0x63,0x68,0x69,0x63,0x6b,0x65,0x6e,0x20,0x73,0x63,0x72,0x61,0x74,0x63,0x68,0x20,0x49,0x20,0x73,
0x63,0x72,0x69,0x62,0x62,0x6c,0x65,0x20,0x61,0x6e,0x64,0x20,0x64,0x6f,0x6f,0x64,0x6c,0x65,0x20,0x65,0x6e,0x6f,0x75,0x67,0x68,0x20,0x72,
0x68,0x79,0x6d,0x65,0x73,0x20,0x54,0x6f,0x20,0x6d,0x61,0x79,0x62,0x65,0x20,0x74,0x72,0x79,0x20,0x74,0x6f,0x20,0x68,0x65,0x6c,0x70,0x20,
0x67,0x65,0x74,0x20,0x73,0x6f,0x6d,0x65,0x20,0x70,0x65,0x6f,0x70,0x6c,0x65,0x20,0x74,0x68,0x72,0x6f,0x75,0x67,0x68,0x20,0x74,0x6f,0x75,
0x67,0x68,0x20,0x74,0x69,0x6d,0x65,0x73,0x20,0x42,0x75,0x74,0x20,0x49,0x20,0x67,0x6f,0x74,0x74,0x61,0x20,0x6b,0x65,0x65,0x70,0x20,0x61,
0x20,0x66,0x65,0x77,0x20,0x70,0x75,0x6e,0x63,0x68,0x6c,0x69,0x6e,0x65,0x73,0x20,0x4a,0x75,0x73,0x74,0x20,0x69,0x6e,0x20,0x63,0x61,0x73,
0x65,0x20,0x27,0x63,0x61,0x75,0x73,0x65,0x20,0x65,0x76,0x65,0x6e,0x20,0x79,0x6f,0x75,0x20,0x75,0x6e,0x73,0x69,0x67,0x6e,0x65,0x64,0x20,
0x52,0x61,0x70,0x70,0x65,0x72,0x73,0x20,0x61,0x72,0x65,0x20,0x68,0x75,0x6e,0x67,0x72,0x79,0x20,0x6c,0x6f,0x6f,0x6b,0x69,0x6e,0x27,0x20,
0x61,0x74,0x20,0x6d,0x65,0x20,0x6c,0x69,0x6b,0x65,0x20,0x69,0x74,0x27,0x73,0x20,0x6c,0x75,0x6e,0x63,0x68,0x74,0x69,0x6d,0x65,0x20,0x49,
0x20,0x6b,0x6e,0x6f,0x77,0x20,0x74,0x68,0x65,0x72,0x65,0x20,0x77,0x61,0x73,0x20,0x61,0x20,0x74,0x69,0x6d,0x65,0x20,0x77,0x68,0x65,0x72,
0x65,0x20,0x6f,0x6e,0x63,0x65,0x20,0x49,0x20,0x57,0x61,0x73,0x20,0x6b,0x69,0x6e,0x67,0x20,0x6f,0x66,0x20,0x74,0x68,0x65,0x20,0x75,0x6e,
0x64,0x65,0x72,0x67,0x42,0x75,0x74,0x20,0x49,0x20,0x73,0x74,0x69,0x6c,0x6c,0x20,0x72,0x61,0x70,0x20,0x6c,0x69,0x6b,0x65,0x20,0x49,0x27,
0x6d,0x20,0x6f,0x6e,0x20,0x6d,0x79,0x20,0x50,0x68,0x61,0x72,0x6f,0x61,0x68,0x65,0x20,0x4d,0x6f,0x6e,0x63,0x68,0x20,0x67,0x72,0x69,0x6e,
0x64,0x20,0x53,0x6f,0x20,0x49,0x20,0x63,0x72,0x75,0x6e,0x63,0x68,0x20,0x72,0x68,0x79,0x6d,0x65,0x73,0x2c,0x20,0x62,0x75,0x74,0x20,0x73,
0x6f,0x6d,0x65,0x74,0x69,0x6d,0x65,0x73,0x20,0x77,0x68,0x65,0x6e,0x20,0x79,0x6f,0x75,0x20,0x63,0x6f,0x6d,0x62,0x69,0x6e,0x65,0x20,0x41,
0x20,0x77,0x69,0x74,0x68,0x20,0x74,0x68,0x65,0x20,0x73,0x6b,0x69,0x6e,0x20,0x63,0x6f,0x6c,0x6f,0x72,0x20,0x6f,0x66,0x20,0x6d,0x69,0x6e,
0x65,0x20,0x59,0x6f,0x75,0x20,0x67,0x65,0x74,0x20,0x74,0x6f,0x6f,0x20,0x62,0x69,0x67,0x20,0x61,0x6e,0x64,0x20,0x68,0x65,0x72,0x65,0x20,
0x74,0x68,0x65,0x79,0x20,0x63,0x6f,0x6d,0x65,0x20,0x74,0x72,0x79,0x69,0x6e,0x27,0x20,0x54,0x6f,0x20,0x63,0x65,0x6e,0x73,0x6f,0x72,0x20,
0x79,0x6f,0x75,0x20,0x6c,0x69,0x6b,0x65,0x20,0x74,0x68,0x61,0x74,0x20,0x6f,0x6e,0x65,0x20,0x6c,0x69,0x6e,0x65,0x20,0x49,0x20,0x73,0x61,
0x69,0x64,0x20,0x6f,0x6e,0x20,0x22,0x49,0x27,0x6d,0x20,0x42,0x61,0x63,0x6b,0x22,0x20,0x66,0x72,0x6f,0x6d,0x20,0x54,0x68,0x65,0x20,0x4d,
0x61,0x74,0x68,0x65,0x72,0x73,0x20,0x4c,0x50,0x20,0x31,0x20,0x77,0x68,0x65,0x6e,0x20,0x49,0x20,0x54,0x72,0x69,0x65,0x64,0x20,0x74,0x6f,
0x20,0x73,0x61,0x79,0x20,0x49,0x27,0x6c,0x6c,0x20,0x74,0x61,0x6b,0x65,0x20,0x73,0x65,0x76,0x65,0x6e,0x20,0x6b,0x69,0x64,0x73,0x20,0x66,
0x72,0x6f,0x6d,0x20,0x43,0x6f,0x6c,0x75,0x6d,0x62,0x69,0x6e,0x65,0x20,0x50,0x75,0x74,0x20,0x27,0x65,0x6d,0x20,0x61,0x6c,0x6c,0x20,0x69,
0x6e,0x20,0x61,0x20,0x6c,0x69,0x6e,0x65,0x2c,0x20,0x61,0x64,0x64,0x20,0x61,0x6e,0x20,0x41,0x4b,0x2d,0x34,0x37,0x2c,0x20,0x61,0x20,0x72,
0x65,0x76,0x6f,0x6c,0x76,0x65,0x72,0x20,0x61,0x6e,0x64,0x20,0x61,0x20,0x39,0x20,0x53,0x65,0x65,0x20,0x69,0x66,0x20,0x49,0x20,0x67,0x65,
0x74,0x20,0x61,0x77,0x61,0x79,0x20,0x77,0x69,0x74,0x68,0x20,0x69,0x74,0x20,0x6e,0x6f,0x77,0x20,0x74,0x68,0x61,0x74,0x20,0x49,0x20,0x61,
0x69,0x6e,0x27,0x74,0x20,0x61,0x73,0x20,0x62,0x69,0x67,0x20,0x61,0x73,0x20,0x49,0x20,0x77,0x61,0x73,0x2c,0x20,0x62,0x75,0x74,0x20,0x49,
0x27,0x6d,0x20,0x4d,0x6f,0x72,0x70,0x68,0x69,0x6e,0x27,0x20,0x69,0x6e,0x74,0x6f,0x20,0x61,0x6e,0x20,0x69,0x6d,0x6d,0x6f,0x72,0x74,0x61,
0x6c,0x2c,0x20,0x63,0x6f,0x6d,0x69,0x6e,0x27,0x20,0x74,0x68,0x72,0x6f,0x75,0x67,0x68,0x20,0x74,0x68,0x65,0x20,0x61,0x70,0x6f,0x72,0x74,
0x61,0x6c,0x20,0x59,0x6f,0x75,0x27,0x72,0x65,0x20,0x73,0x74,0x75,0x63,0x6b,0x20,0x69,0x6e,0x20,0x61,0x20,0x74,0x69,0x6d,0x65,0x20,0x77,
0x61,0x72,0x70,0x20,0x66,0x72,0x6f,0x6d,0x20,0x32,0x30,0x30,0x34,0x20,0x74,0x68,0x6f,0x75,0x67,0x68,0x20,0x41,0x6e,0x64,0x20,0x49,0x20,
0x64,0x6f,0x6e,0x27,0x74,0x20,0x6b,0x6e,0x6f,0x77,0x20,0x77,0x68,0x61,0x74,0x20,0x74,0x68,0x65,0x20,0x66,0x75,0x63,0x6b,0x20,0x74,0x68,
0x61,0x74,0x20,0x79,0x6f,0x75,0x20,0x72,0x68,0x79,0x6d,0x65,0x20,0x66,0x6f,0x72,0x20,0x59,0x6f,0x75,0x27,0x72,0x65,0x20,0x70,0x6f,0x69,
0x6e,0x74,0x6c,0x65,0x73,0x73,0x20,0x61,0x73,0x20,0x52,0x61,0x70,0x75,0x6e,0x7a,0x65,0x6c,0x20,0x77,0x69,0x74,0x68,0x20,0x66,0x75,0x63,
0x6b,0x69,0x6e,0x27,0x20,0x63,0x6f,0x72,0x6e,0x72,0x6f,0x77,0x73,0x20,0x59,0x6f,0x75,0x20,0x77,0x72,0x69,0x74,0x65,0x20,0x6e,0x6f,0x72,
0x6d,0x61,0x6c,0x3f,0x20,0x46,0x75,0x63,0x6b,0x20,0x62,0x65,0x69,0x6e,0x67,0x20,0x6e,0x6f,0x72,0x6d,0x61,0x6c,0x21,0x20,0x41,0x6e,0x64,
0x20,0x49,0x20,0x6a,0x75,0x73,0x74,0x20,0x62,0x6f,0x75,0x67,0x68,0x74,0x20,0x61,0x20,0x6e,0x65,0x77,0x20,0x72,0x61,0x79,0x67,0x75,0x6e,
0x20,0x66,0x72,0x6f,0x6d,0x20,0x74,0x68,0x65,0x20,0x66,0x75,0x74,0x75,0x72,0x65,0x20,0x4a,0x75,0x73,0x74,0x20,0x74,0x6f,0x20,0x63,0x6f,
0x6d,0x65,0x20,0x61,0x6e,0x64,0x20,0x73,0x68,0x6f,0x6f,0x74,0x20,0x79,0x61,0x2c,0x20,0x6c,0x69,0x6b,0x65,0x20,0x77,0x68,0x65,0x6e,0x20,
0x46,0x61,0x62,0x6f,0x6c,0x6f,0x75,0x73,0x20,0x6d,0x61,0x64,0x65,0x20,0x52,0x61,0x79,0x20,0x4a,0x20,0x6d,0x61,0x64,0x20,0x27,0x43,0x61,
0x75,0x73,0x65,0x20,0x46,0x61,0x62,0x20,0x73,0x61,0x69,0x64,0x20,0x68,0x65,0x20,0x6c,0x6f,0x6f,0x6b,0x65,0x64,0x20,0x6c,0x69,0x6b,0x65,
0x20,0x61,0x20,0x66,0x61,0x67,0x20,0x61,0x74,0x20,0x4d,0x61,0x79,0x77,0x65,0x61,0x74,0x68,0x65,0x72,0x27,0x73,0x20,0x70,0x61,0x64,0x20,
0x53,0x69,0x6e,0x67,0x69,0x6e,0x27,0x20,0x74,0x6f,0x20,0x61,0x20,0x6d,0x61,0x6e,0x20,0x77,0x68,0x69,0x6c,0x65,0x20,0x68,0x65,0x20,0x70,
0x6c,0x61,0x79,0x65,0x64,0x20,0x70,0x69,0x61,0x6e,0x6f,0x20,0x4d,0x61,0x6e,0x2c,0x20,0x6f,0x68,0x20,0x6d,0x61,0x6e,0x2c,0x20,0x74,0x68,
0x61,0x74,0x20,0x77,0x61,0x73,0x20,0x61,0x20,0x32,0x34,0x2f,0x37,0x20,0x73,0x70,0x65,0x63,0x69,0x61,0x6c,0x20,0x6f,0x6e,0x20,0x74,0x68,
0x65,0x20,0x63,0x61,0x62,0x6c,0x65,0x20,0x63,0x68,0x61,0x6e,0x6e,0x65,0x6c,0x20,0x53,0x6f,0x20,0x52,0x61,0x79,0x20,0x4a,0x20,0x77,0x65,
0x6e,0x74,0x20,0x73,0x74,0x72,0x61,0x69,0x67,0x68,0x74,0x20,0x74,0x6f,0x20,0x74,0x68,0x65,0x20,0x72,0x61,0x64,0x69,0x6f,0x20,0x73,0x74,
0x61,0x74,0x69,0x6f,0x6e,0x20,0x54,0x68,0x65,0x20,0x76,0x65,0x72,0x79,0x20,0x6e,0x65,0x78,0x74,0x20,0x64,0x61,0x79,0x2c,0x20,0x22,0x48,
0x65,0x79,0x20,0x46,0x61,0x62,0x2c,0x20,0x49,0x27,0x6d,0x61,0x20,0x6b,0x69,0x6c,0x6c,0x20,0x79,0x6f,0x75,0x21,0x22,0x20,0x4c,0x79,0x72,
0x69,0x63,0x73,0x20,0x63,0x6f,0x6d,0x69,0x6e,0x27,0x20,0x61,0x74,0x20,0x79,0x6f,0x75,0x20,0x61,0x74,0x20,0x73,0x75,0x70,0x65,0x72,0x73,
0x6f,0x6e,0x69,0x63,0x20,0x73,0x70,0x65,0x65,0x64,0x20,0x28,0x4a,0x2e,0x4a,0x2e,0x20,0x46,0x61,0x64,0x29,0x20,0x55,0x68,0x2c,0x20,0x73,
0x75,0x6d,0x6d,0x61,0x2d,0x6c,0x75,0x6d,0x6d,0x61,0x2c,0x20,0x64,0x6f,0x6f,0x6d,0x61,0x2d,0x6c,0x75,0x6d,0x6d,0x61,0x2c,0x20,0x79,0x6f,
0x75,0x20,0x61,0x73,0x73,0x75,0x6d,0x69,0x6e,0x27,0x20,0x49,0x27,0x6d,0x20,0x61,0x20,0x68,0x75,0x6d,0x61,0x6e,0x20,0x57,0x68,0x61,0x74,
0x20,0x49,0x20,0x67,0x6f,0x74,0x74,0x61,0x20,0x64,0x6f,0x20,0x74,0x6f,0x20,0x67,0x65,0x74,0x20,0x69,0x74,0x20,0x74,0x68,0x72,0x6f,0x75,
0x67,0x68,0x20,0x74,0x6f,0x20,0x79,0x6f,0x75,0x3f,0x20,0x49,0x27,0x6d,0x20,0x73,0x75,0x70,0x65,0x72,0x68,0x75,0x6d,0x61,0x6e,0x20,0x49,
0x6e,0x6e,0x6f,0x76,0x61,0x74,0x69,0x76,0x65,0x20,0x61,0x6e,0x64,0x20,0x49,0x27,0x6d,0x20,0x6d,0x61,0x64,0x65,0x20,0x6f,0x66,0x20,0x72,
0x75,0x62,0x62,0x65,0x72,0x20,0x73,0x6f,0x20,0x74,0x68,0x61,0x74,0x20,0x61,0x6e,0x79,0x74,0x68,0x69,0x6e,0x67,0x20,0x79,0x6f,0x75,0x20,
0x73,0x61,0x79,0x20,0x69,0x73,0x20,0x72,0x69,0x63,0x6f,0x63,0x68,0x65,0x74,0x69,0x6e,0x27,0x20,0x6f,0x66,0x66,0x20,0x6f,0x66,0x20,0x6d,
0x65,0x20,0x61,0x6e,0x64,0x20,0x69,0x74,0x27,0x6c,0x6c,0x20,0x67,0x6c,0x75,0x65,0x20,0x74,0x6f,0x20,0x79,0x6f,0x75,0x20,0x61,0x6e,0x64,
0x20,0x49,0x27,0x6d,0x20,0x64,0x65,0x76,0x61,0x73,0x74,0x61,0x74,0x69,0x6e,0x67,0x2c,0x20,0x6d,0x6f,0x72,0x65,0x20,0x74,0x68,0x61,0x6e,
0x20,0x65,0x76,0x65,0x72,0x20,0x64,0x65,0x6d,0x6f,0x6e,0x73,0x74,0x72,0x61,0x74,0x69,0x6e,0x67,0x20,0x48,0x6f,0x77,0x20,0x74,0x6f,0x20,
0x67,0x69,0x76,0x65,0x20,0x61,0x20,0x6d,0x6f,0x74,0x68,0x65,0x72,0x66,0x75,0x63,0x6b,0x69,0x6e,0x27,0x20,0x61,0x75,0x64,0x69,0x65,0x6e,
0x63,0x65,0x20,0x61,0x20,0x66,0x65,0x65,0x6c,0x69,0x6e,0x67,0x20,0x6c,0x69,0x6b,0x65,0x20,0x69,0x74,0x27,0x73,0x20,0x6c,0x65,0x76,0x69,
0x74,0x61,0x74,0x69,0x6e,0x67,0x20,0x4e,0x65,0x76,0x65,0x72,0x20,0x66,0x61,0x64,0x69,0x6e,0x67,0x2c,0x20,0x61,0x6e,0x64,0x20,0x49,0x20,
0x6b,0x6e,0x6f,0x77,0x20,0x74,0x68,0x65,0x20,0x68,0x61,0x74,0x65,0x72,0x73,0x20,0x61,0x72,0x65,0x20,0x66,0x6f,0x72,0x65,0x76,0x65,0x72,
0x20,0x77,0x61,0x69,0x74,0x69,0x6e,0x67,0x20,0x49,0x6c,0x6c,0x20,0x77,0x68,0x65,0x6e,0x20,0x49,0x20,0x73,0x70,0x65,0x61,0x6b,0x20,0x69,
0x6e,0x20,0x74,0x6f,0x6e,0x67,0x75,0x65,0x73,0x2c,0x20,0x62,0x75,0x74,0x20,0x69,0x74,0x27,0x73,0x20,0x73,0x74,0x69,0x6c,0x6c,0x20,0x74,
0x6f,0x6e,0x67,0x75,0x65,0x2d,0x69,0x6e,0x2d,0x63,0x68,0x65,0x65,0x6b,0x2c,0x20,0x66,0x75,0x63,0x6b,0x20,0x79,0x6f,0x75,0x20,0x27,0x43,
0x61,0x75,0x73,0x65,0x20,0x49,0x20,0x6b,0x6e,0x6f,0x77,0x20,0x74,0x68,0x65,0x20,0x77,0x61,0x79,0x20,0x74,0x6f,0x20,0x67,0x65,0x74,0x20,
0x27,0x65,0x6d,0x20,0x6d,0x6f,0x74,0x69,0x76,0x61,0x74,0x65,0x64,0x20,0x44,0x6f,0x6e,0x27,0x74,0x20,0x6d,0x69,0x73,0x74,0x61,0x6b,0x65,
0x20,0x68,0x69,0x6d,0x20,0x66,0x6f,0x72,0x20,0x53,0x61,0x74,0x61,0x6e,0x20,0x49,0x74,0x27,0x73,0x20,0x61,0x20,0x66,0x61,0x74,0x61,0x6c,
0x20,0x6d,0x69,0x73,0x74,0x61,0x6b,0x65,0x20,0x69,0x66,0x20,0x79,0x6f,0x75,0x20,0x74,0x68,0x69,0x6e,0x6b,0x20,0x49,0x20,0x6e,0x65,0x65,
0x64,0x20,0x74,0x6f,0x20,0x62,0x65,0x20,0x6f,0x76,0x65,0x72,0x73,0x65,0x61,0x73,0x20,0x61,0x6e,0x64,0x20,0x74,0x61,0x6b,0x65,0x20,0x61,
0x20,0x76,0x61,0x63,0x61,0x74,0x69,0x6f,0x6e,0x20,0x54,0x6f,0x20,0x74,0x72,0x69,0x70,0x20,0x61,0x20,0x62,0x72,0x6f,0x61,0x64,0x2c,0x20,
0x61,0x6e,0x64,0x20,0x6d,0x61,0x6b,0x65,0x20,0x68,0x65,0x72,0x20,0x66,0x61,0x6c,0x6c,0x20,0x6f,0x6e,0x20,0x68,0x65,0x72,0x20,0x66,0x61,
0x63,0x65,0x20,0x61,0x6e,0x64,0x20,0x44,0x6f,0x6e,0x27,0x74,0x20,0x62,0x65,0x20,0x61,0x20,0x72,0x65,0x74,0x61,0x72,0x64,0xe2,0x80,0x94,
0x62,0x65,0x20,0x61,0x20,0x6b,0x69,0x6e,0x67,0x3f,0x20,0x54,0x68,0x69,0x6e,0x6b,0x20,0x6e,0x6f,0x74,0x20,0x57,0x68,0x79,0x20,0x62,0x65,
0x20,0x61,0x20,0x6b,0x69,0x6e,0x67,0x20,0x77,0x68,0x65,0x6e,0x20,0x79,0x6f,0x75,0x20,0x63,0x61,0x6e,0x20, 0x44, 0x12,0x02};

                                
                            
uint8_t text[BLOCK_SIZE];
#define CLAIMEDMEMORY 15820
//#define CMACTEST 1
uint8_t mac[BLOCK_SIZE];
volatile int running = 1;
static volatile bool alarm_fired;
int main ()
{
    stdio_init_all();
    gpioSetup();
    uint8_t orgText[BLOCK_SIZE];
    /*
   This part contains init for encryption and measurment
    */ 
    for (int i=0; i<BLOCKS*BLOCK_SIZE; i++)
        {
            printf("%d inputs left\n", (BLOCKS*BLOCK_SIZE-i));
            text[i] = getchar();
        }
     for (int i=0; i<BLOCKS*BLOCK_SIZE; i++)
     {
        orgText[i]=text[i];
     }
    AES_CMAC(key,text,1,mac); // generates a mac that can be used for verification
    struct AES_ctx ctx;
    AES_init_ctx(&ctx, key);
    int numberOfCycles [MAXTESTS];
    double timeElapsed[MAXTESTS];
    for(int i = 0; i<CLAIMEDMEMORY; i++)
    {
        memoryClaim(1);
        printf("%d \n",i);
    }

    while(true)
    {
       // timer_in_us(TIMER); //uncomment this if running interruptions
        for(int i = 0; i <MAXTESTS; i++)
        {
        if(floatOp)
        {
        floating(1.23, CYCLES*i);
        numberOfCycles[i]=CYCLES*i;
        timeElapsed[i] = globalReturnExec;
        }
        else if (encryption)
        {
            encryptionTest(AES_ITERATIONS, &ctx, text);
            numberOfCycles[i]=AES_ITERATIONS*i;
            timeElapsed[i] = globalReturnExec;
        }
        else if (decryption)
        {   
            decryptionTest(AES_ITERATIONS, &ctx, text);
            numberOfCycles[i]=AES_ITERATIONS*i;
            timeElapsed[i] = globalReturnExec;
           
            
        }
        
        cyclesRun = 0;
        globalReturnExec = 0;
        }
        printf("tests done!\n");
        running = 0;
        for(int i =0; i<MAXTESTS; i++)
        {
            printf("%d cycles  %.0f microseconds \n",numberOfCycles[i], timeElapsed[i]);
        }
        #ifdef CMACTEST
        for(int i =0; i<MAXTESTS; i++)
        {
            uint64_t starttime=time_us_64();
            AES_CMAC_CHECK(key,text,1,mac);
            uint64_t endtime=time_us_64();
            timeElapsed[i] = (double)(endtime-starttime); 
            printf("%.0f\n", timeElapsed[i]);
        }
        #endif
        #ifdef LONGTEST
        for(int i = 0; i <4096; i++)
        {
            printf("%c",longText[i]);
        }
        uint64_t starttime=time_us_64();
        for(int i = 0; i<256; i++)
        {
            AES_ECB_decrypt(&ctx ,(longText+i*16));
        
        }
        uint64_t endtime=time_us_64();
        double exectime = (double)(endtime-starttime); 
        #endif
        while(!running)
        {
       
        }
        
    }
    
}
/* arguments: int size - how big the array that is created will be */
int * memoryClaim(int size){
    /* Starts a local timer */
    uint64_t startLocal = time_us_64();
    /* Claims a chunk of memory. Amount claimed is based on int size.
    returns a pointer to the adress of the first position of the array. */
    int *bigArray = calloc(size, sizeof(int));
        for(int i = 0; i <size; i++)
        {
            bigArray[i]=i;
        }
        
        uint64_t endLocal = time_us_64();
        double execLocal = (double)(endLocal-startLocal);
        globalReturnExec += execLocal;
    return bigArray;
}

void gpioSetup(){ // Setup for interrupts and GPIO
    gpio_init(irq1Pin);
    gpio_init(irq2Pin);
    gpio_init(irq3Pin);
    gpio_init(irq4Pin);
    gpio_set_dir(irq1Pin, GPIO_IN);
    gpio_set_dir(irq2Pin, GPIO_IN);
    gpio_set_dir(irq3Pin, GPIO_IN);
    gpio_set_dir(irq4Pin, GPIO_IN);
    gpio_set_irq_enabled(irq2Pin, GPIO_IRQ_EDGE_RISE, true);
    gpio_set_irq_enabled(irq3Pin, GPIO_IRQ_EDGE_RISE, true);
    gpio_set_irq_enabled(irq4Pin, GPIO_IRQ_EDGE_RISE, true);
    gpio_add_raw_irq_handler(irq2Pin, &irq_handler);
    gpio_set_irq_enabled_with_callback(irq1Pin,GPIO_IRQ_EDGE_RISE, true, &irq_handler);
    

}





double floating(double d, int cycles){

    /* Starts local timer */
    uint64_t startLocal = time_us_64();
    
    /* Arbitrarily assigned values / a randomises based on d */
    double a=2.43*d;
    double b=3.2356583632;
    double c =2.259474;
        #ifdef CMAC
        AES_CMAC_CHECK(key,text,1,mac);
        #endif
    /* creates 4 different floating points divisions */
    for(volatile int i=0; i < cycles; i++)
    {
        b = a/b;
        a = b/a;
        c = a/b;
        c = c/b;   
    }

    /*
    Sends back execution time through global variable. Due to IRQ stopping clk
    */
    uint64_t endLocal = time_us_64();
    double execLocal = (double)(endLocal - startLocal); //can be optimised to not have execLocal. 
    //globalReturnExec += execLocal;  // this needs to be removed when testing with software interrupts

    return a/b/c;
}

void encryptionTest(int iterations, const struct AES_ctx* ctx, u_int8_t* text)
{
    /* Starts local timer */
    uint64_t startLocal = time_us_64();
    for(int i =0; i < iterations; i++)
    {
        AES_ECB_encrypt(ctx, text);

    }
    uint64_t endLocal = time_us_64();
    double execLocal = (double)(endLocal - startLocal); //can be optimised to not have execLocal. 
    globalReturnExec += execLocal;
}
void decryptionTest(int iterations, const struct AES_ctx* ctx, u_int8_t* text)
{
    /* Starts local timer */
    uint64_t startLocal = time_us_64();
    for(int i =0; i < iterations; i++)
    {
        AES_ECB_decrypt(ctx, text);
    }
    uint64_t endLocal = time_us_64();
    double execLocal = (double)(endLocal - startLocal); //can be optimised to not have execLocal. 
    globalReturnExec += execLocal;
}

void irq_handler()
{
    
    //static int *bigArray;
 
    if(gpio_get_irq_event_mask(irq1Pin) & GPIO_IRQ_EDGE_RISE)
    {
        gpio_acknowledge_irq(irq1Pin,GPIO_IRQ_EDGE_RISE);
        floatOp = 1;
        encryption = 0;
        decryption = 0;
        printf("testing floating point operations ");
        #ifdef CMAC
        printf("with CMAC authentication\n");
        #else
        printf("\n");
        #endif
        #ifdef debug
        printf("irq 1: ");
        #endif


    }
    if(gpio_get_irq_event_mask(irq2Pin) & GPIO_IRQ_EDGE_RISE)
    {
        gpio_acknowledge_irq(irq2Pin,GPIO_IRQ_EDGE_RISE);
        floatOp = 0;
        encryption = 1;
        decryption = 0;
        printf("testing encryption\n");
        #ifdef debug
        printf("irq 2: ");
        #endif
        

    }
    if(gpio_get_irq_event_mask(irq3Pin) & GPIO_IRQ_EDGE_RISE)
    {
        
        floatOp = 0;
        encryption = 0;
        decryption = 1;
        printf("testing decryption\n");
        #ifdef debug
        printf("irq 3: ");
        printf("\n");
        #endif
    }
    if(gpio_get_irq_event_mask(irq4Pin) & GPIO_IRQ_EDGE_RISE)
    {
        gpio_acknowledge_irq(irq4Pin,GPIO_IRQ_EDGE_RISE);
        #ifdef debug
        printf("irq 4: ");
        printf("\n");
        printf("%d\n",running);
        #endif
    
        if(!running)
        {
        running = 1;
        //printf("Starting  test\n");
        }
        
    }
}

static void timer_in_us(uint32_t delay_us) {
    
    
    // Enable the interrupt for our alarm (the timer outputs 4 alarm irqs)
    hw_set_bits(&timer_hw->inte, 1u << ALARM_NUM);
    // Set irq handler for alarm irq
    irq_set_exclusive_handler(ALARM_IRQ, timer_irq);
    // Enable the alarm irq
    irq_set_enabled(ALARM_IRQ, true);
    // Enable interrupt in block and at processor

    // Alarm is only 32 bits so if trying to delay more
    // than that need to be careful and keep track of the upper
    // bits
    uint64_t target = timer_hw->timerawl + delay_us;

    // Write the lower 32 bits of the target time to the alarm which
    // will arm it
    timer_hw->alarm[ALARM_NUM] = (uint32_t) target;
    

}
static void timer_irq(void) {
    // Clear the alarm irq
    hw_clear_bits(&timer_hw->intr, 1u << ALARM_NUM);
    if(running)
    {
        floating(1.23, INTERRUPTITERATIONS);
        timer_in_us(TIMER);
    }
    // Assume alarm 0 has fired
    #ifdef debug
    printf("Timer fired\n");
    #endif
    alarm_fired = true;
}
